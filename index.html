<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto TM01 - APP Puerto Salgar - Barrancabermeja</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6; color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1000px; margin: 0 auto; background: #fff; border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 60px; }
        .header { text-align: center; margin-bottom: 50px; padding-bottom: 30px; border-bottom: 3px solid #667eea; }
        h1 { color: #667eea; font-size: 2.8em; margin-bottom: 15px; }
        .subtitle { color: #666; font-size: 1.3em; margin-bottom: 20px; }
        .status { display: inline-block; background: #4caf50; color: #fff; padding: 8px 20px; border-radius: 25px;
            font-size: .95em; font-weight: bold; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; margin: 40px 0; }
        .info-card { background: linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); padding: 25px; border-radius: 15px;
            border-left: 5px solid #667eea; }
        .info-card h3 { color: #667eea; margin-bottom: 12px; font-size: 1.1em; }
        .info-card p { color: #666; font-size: .95em; }
        .section { margin: 40px 0; }
        .section h2 { color: #667eea; font-size: 1.6em; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid #e9ecef; }
        .phase-list { background: #f8f9fa; padding: 20px; border-radius: 12px; }
        .phase-list li { list-style: none; padding: 10px 0; border-bottom: 1px solid #e0e0e0; }
        .phase-list li:last-child { border-bottom: 0; }
        .phase-list li.completed::before { content: '✅ '; }
        .phase-list li.active::before { content: '🔄 '; }
        .phase-list li.pending::before { content: '⏳ '; }
        .links { margin-top: 40px; display: flex; gap: 16px; flex-wrap: wrap; justify-content: center; }
        .btn { display: inline-flex; align-items: center; gap: 10px; padding: 12px 28px; background: #667eea; color: #fff;
            text-decoration: none; border-radius: 10px; font-weight: 600; }
        .btn:hover { background: #764ba2; }
        .btn-secondary { background: #fff; color: #667eea; border: 2px solid #667eea; }
        .btn-secondary:hover { background: #667eea; color: #fff; }
        .footer { margin-top: 50px; padding-top: 20px; border-top: 2px solid #e9ecef; text-align: center; color: #999; }
        @media (max-width: 768px) { .container { padding: 30px 20px; } h1 { font-size: 2em; } .btn { width: 100%; justify-content: center; } }
    </style>
</head>
<body>
    <!-- LOGIN FORM (copiado del ejemplo, adaptado a TM01) -->
    <div class="login-container" id="loginContainer" style="max-width:520px;margin:40px auto;background:#fff;border-radius:16px;box-shadow:0 18px 50px rgba(0,0,0,.25);padding:24px;">
        <div class="logo" style="text-align:center;margin-bottom:12px;">
            <h1 style="margin:0 0 6px;">🏗️ Sistema TM01</h1>
            <p style="margin:0;color:#666;">Troncal Magdalena</p>
            <span class="project-badge" style="display:inline-block;margin-top:6px;color:#667eea;">v3.3 | Acceso Seguro</span>
        </div>

        <form id="loginForm" onsubmit="return handleLogin(event)" style="display:flex;flex-direction:column;gap:12px;">
            <div class="form-group">
                <label for="username">👤 Usuario</label>
                <input type="text" id="username" placeholder="Ingrese su usuario" autocomplete="username" required style="padding:10px 12px;border:1px solid #e0e0e0;border-radius:8px;font-size:14px;">
            </div>

            <div class="form-group">
                <label for="password">🔒 Contraseña</label>
                <input type="password" id="password" placeholder="Ingrese su contraseña" autocomplete="current-password" required style="padding:10px 12px;border:1px solid #e0e0e0;border-radius:8px;font-size:14px;">
            </div>

            <button type="submit" class="btn-login" style="padding:10px 14px;border:none;border-radius:8px;background:#667eea;color:#fff;font-weight:600;cursor:pointer;">Acceder al Sistema</button>

            <div class="spinner" id="spinner" style="display:none;height:18px;"></div>
            <div class="error-message" id="errorMessage" style="display:none;color:#c0392b;font-size:13px;">❌ Usuario o contraseña incorrectos</div>
        </form>

        <div class="info-box" style="margin-top:12px;color:#666;font-size:13px;">
            <h3 style="margin:0 0 6px;">📋 Información del Sistema</h3>
            <p style="margin:0 0 8px;">Sistema de Validación Web TM01 con arquitectura dinámica de 4 capas, gestión de DTs y sincronización automática.</p>
            <p style="margin:0;color:#999;">ℹ️ Solicitar credenciales a PMO</p>
        </div>

        <div class="version" style="margin-top:10px;text-align:center;color:#999;">Sistema v3.3 | Octubre 2025 | TM01 Troncal Magdalena</div>
    </div>

    <!-- PORTAL PRINCIPAL (después del login) -->
    <div class="container" id="portalContainer" style="display:none;">
        <div class="header">
            <h1>🚀 Proyecto TM01</h1>
            <p class="subtitle">Asociación Público-Privada (APP)<br>Puerto Salgar - Barrancabermeja</p>
            <div class="status">✅ GitHub Pages activo</div>
        </div>
        <div class="info-grid">
            <div class="info-card"><h3>📊 Estado</h3><p>Sistema web reconstruido con arquitectura de 4 capas.</p></div>
            <div class="info-card"><h3>📅 Inicio</h3><p>16 de Octubre 2025</p></div>
            <div class="info-card"><h3>⏱️ Duración</h3><p>12-16 semanas</p></div>
            <div class="info-card"><h3>📁 Documentos</h3><p>85+ documentos técnicos</p></div>
        </div>
        <div class="section">
            <h2>📋 Fases del Proyecto</h2>
            <ul class="phase-list">
                <li class="completed"><strong>Fase 0:</strong> Preparación y Estructuración</li>
                <li class="completed"><strong>Fase 1:</strong> Conversión de Documentos</li>
                <li class="completed"><strong>Fase 2:</strong> Identificación de Sistemas</li>
                <li class="completed"><strong>Fase 3:</strong> Templates y Arquitectura</li>
                <li class="completed"><strong>Fase 4:</strong> Documentación Técnica</li>
                <li class="completed"><strong>Fase 5:</strong> Consolidación y Entregables</li>
                <li class="completed"><strong>Fase 6:</strong> Validación Web (4 capas)</li>
            </ul>
        </div>
        <div class="links">
            <a class="btn" href="docs/WBS_Menu_Principal.html">📊 Dashboard WBS</a>
            <a class="btn" href="docs/wbs.html">📋 WBS</a>
            <a class="btn" href="docs/layout.html">🗺️ Layout</a>
            <a class="btn" href="docs/presupuesto.html">💰 Presupuesto</a>
            <a class="btn btn-secondary" href="README.md">📖 README</a>
            <a class="btn btn-secondary" href="ROADMAP.md">🗺️ ROADMAP</a>
        </div>
        <div class="footer">
            <p>TM01 Troncal Magdalena — Sistema Web dinámico con arquitectura de 4 capas.</p>
            <p>Última actualización: <script>document.write(new Date().toLocaleString('es-CO'))</script></p>
        </div>
    </div>

    <script>
        // ================================================================
        // CONFIGURACIÓN DE AUTENTICACIÓN (alineada al ejemplo)
        // ================================================================
        const VALID_USER = '0rt1z';
        const VALID_PASSWORD = '0rt1z';
        let intentosLogin = 0;
        const MAX_INTENTOS = 5;
        const TIMEOUT_BLOQUEO = 300000; // 5 minutos
        const TIMEOUT_SESION = 1800000; // 30 minutos
        let ultimaActividad = Date.now();

        window.addEventListener('DOMContentLoaded', function() {
            const isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
            const username = sessionStorage.getItem('username');
            if (isAuthenticated && username) {
                // Redirigir directamente al menú principal WBS
                window.location.href = 'docs/WBS_Menu_Principal.html';
                return;
            }
        });

        function handleLogin(event) {
            event.preventDefault();
            if (intentosLogin >= MAX_INTENTOS) { alert('⚠️ Demasiados intentos fallidos. Espera 5 minutos.'); return false; }
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            const spinner = document.getElementById('spinner');
            errorMessage.style.display = 'none';
            spinner.style.display = 'block';
            setTimeout(() => {
                spinner.style.display = 'none';
                if (username === VALID_USER && password === VALID_PASSWORD) {
                    intentosLogin = 0;
                    sessionStorage.setItem('authenticated', 'true');
                    sessionStorage.setItem('username', username);
                    showPortal(username);
                    iniciarMonitoreoSesion();
                    // Redirigir al menú principal WBS
                    window.location.href = 'docs/WBS_Menu_Principal.html';
                } else {
                    intentosLogin++;
                    errorMessage.textContent = `❌ Usuario o contraseña incorrectos (${intentosLogin}/${MAX_INTENTOS})`;
                    errorMessage.style.display = 'block';
                    document.getElementById('password').value = '';
                    document.getElementById('password').focus();
                    if (intentosLogin >= MAX_INTENTOS) {
                        errorMessage.textContent = '🔒 Demasiados intentos. Bloqueado por 5 minutos.';
                        setTimeout(() => { intentosLogin = 0; errorMessage.style.display = 'none'; }, TIMEOUT_BLOQUEO);
                    }
                }
            }, 300);
            return false;
        }

        function showPortal(username) {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('portalContainer').style.display = 'block';
            const badge = document.createElement('div');
            badge.style.display = 'none'; // no mostramos user en landing
        }

        function handleLogout() {
            sessionStorage.removeItem('authenticated');
            sessionStorage.removeItem('username');
            window.location.reload();
        }

        function iniciarMonitoreoSesion() {
            document.addEventListener('mousemove', () => { ultimaActividad = Date.now(); });
            document.addEventListener('keypress', () => { ultimaActividad = Date.now(); });
            setInterval(() => {
                if (Date.now() - ultimaActividad > TIMEOUT_SESION) {
                    alert('⚠️ Tu sesión ha expirado por inactividad. Serás redirigido al login.');
                    handleLogout();
                }
            }, 60000);
        }
    </script>
</body>
</html>
