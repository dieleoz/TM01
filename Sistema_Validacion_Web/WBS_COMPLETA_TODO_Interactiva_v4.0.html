<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBS Completa Interactiva v4.0 - TM01 Troncal Magdalena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-info {
            background: #3498db;
            color: white;
        }

        .btn-info:hover {
            background: #2980b9;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 600;
            color: #2c3e50;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .wbs-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .wbs-container h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .wbs-tree {
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }

        .wbs-item {
            margin: 8px 0;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .wbs-item:hover {
            background: rgba(52, 152, 219, 0.1);
            border-left-color: #3498db;
        }

        .wbs-level-1 {
            background: linear-gradient(90deg, #e3f2fd, #bbdefb);
            font-weight: bold;
            font-size: 1.1em;
            margin-left: 0px;
        }

        .wbs-level-2 {
            background: linear-gradient(90deg, #f3e5f5, #e1bee7);
            margin-left: 20px;
            font-weight: 600;
        }

        .wbs-level-3 {
            background: linear-gradient(90deg, #e8f5e8, #c8e6c9);
            margin-left: 40px;
        }

        .wbs-item.selected {
            background: linear-gradient(90deg, #ffebee, #ffcdd2);
            border-left-color: #f44336;
        }

        .item-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-content {
            flex: 1;
        }

        .button-container {
            display: flex;
            gap: 5px;
        }

        .dt-button, .detail-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s ease;
        }

        .dt-button:hover {
            background: #218838;
        }

        .detail-button {
            background: #007bff;
        }

        .detail-button:hover {
            background: #0056b3;
        }

        .analysis-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .analysis-panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .analysis-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            border: none;
            background: #ecf0f1;
            color: #2c3e50;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab:hover {
            background: #2980b9;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .impact-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .impact-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .impact-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .impact-card ul {
            list-style: none;
        }

        .impact-card li {
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .logout-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ WBS COMPLETA INTERACTIVA v4.0</h1>
            <p>TM01 Troncal Magdalena - Sistema de Validaci√≥n ITS</p>
            <p>‚úÖ Analiza TODO: Criterios + Impactos + Riesgos + Archivos + Alternativas</p>
        </div>

        <div class="controls">
            <button class="btn btn-success" onclick="exportarWBS()">
                üìä Exportar WBS
            </button>
            <button class="btn btn-warning" onclick="analizarRiesgos()">
                ‚ö†Ô∏è Analizar Riesgos
            </button>
            <button class="btn btn-danger" onclick="proponerCambios()">
                üîÑ Proponer Cambios
            </button>
            <button class="btn btn-info" onclick="generarDT()">
                üìù Generar DT
            </button>
            
            <div class="filter-group">
                <label for="filtroSistema">Filtrar por sistema:</label>
                <select id="filtroSistema" onchange="filtrarPorSistema()">
                    <option value="TODOS">Todos</option>
                    <option value="SOS">SOS</option>
                    <option value="ETD/RADAR">ETD/RADAR</option>
                    <option value="CCTV">CCTV</option>
                    <option value="PMV">PMV</option>
                    <option value="METEO">METEO</option>
                    <option value="WIM">WIM</option>
                </select>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalItems">24</h3>
                <p>Total √çtems WBS</p>
            </div>
            <div class="stat-card">
                <h3 id="totalRiesgos">17</h3>
                <p>Riesgos Identificados</p>
            </div>
            <div class="stat-card">
                <h3 id="totalDTs">5</h3>
                <p>DTs Generados</p>
            </div>
            <div class="stat-card">
                <h3 id="totalCambios">12</h3>
                <p>Cambios Propuestos</p>
            </div>
        </div>

        <div class="wbs-container">
            <h2>üìã Estructura WBS Completa</h2>
            <div class="wbs-tree" id="wbsTree">
                <!-- WBS ser√° generada din√°micamente -->
            </div>
        </div>

        <div class="analysis-panel">
            <h2>üîç Panel de An√°lisis Bidireccional</h2>
            
            <div class="analysis-tabs">
                <button class="tab active" onclick="showTab('criterios')">Criterios</button>
                <button class="tab" onclick="showTab('impactos')">Impactos</button>
                <button class="tab" onclick="showTab('riesgos')">Riesgos</button>
                <button class="tab" onclick="showTab('archivos')">Archivos</button>
                <button class="tab" onclick="showTab('alternativas')">Alternativas</button>
            </div>

            <div id="criterios" class="tab-content active">
                <h3>üìã Criterios T√©cnicos</h3>
                <div class="impact-analysis">
                    <div class="impact-card">
                        <h4>üéØ Criterios Maestros</h4>
                        <ul>
                            <li>‚úÖ Longitud Total: 293 km</li>
                            <li>‚úÖ CCO: La Lizama PK 4+300</li>
                            <li>‚úÖ Sistemas ITS: SOS, ETD/RADAR, CCTV, PMV, Meteo, WIM</li>
                            <li>‚úÖ Cantidades: 88 SOS, 16 ETD/RADAR, 3 Meteo</li>
                        </ul>
                    </div>
                    <div class="impact-card">
                        <h4>üìä Validaciones Contractuales</h4>
                        <ul>
                            <li>‚úÖ 6/6 sistemas validados</li>
                            <li>‚úÖ Trazabilidad contractual completa</li>
                            <li>‚úÖ Metodolog√≠a Punto 42 aplicada</li>
                            <li>‚úÖ Informaci√≥n oficial confirmada</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="impactos" class="tab-content">
                <h3>üí• An√°lisis de Impactos</h3>
                <div class="impact-analysis">
                    <div class="impact-card">
                        <h4>üí∞ Impacto Presupuestal</h4>
                        <ul>
                            <li>Total Proyecto: $7.79M USD</li>
                            <li>SOS: $1.98M USD (25.4%)</li>
                            <li>ETD/RADAR: $3.46M USD (44.4%)</li>
                            <li>CCTV: $1.41M USD (18.1%)</li>
                        </ul>
                    </div>
                    <div class="impact-card">
                        <h4>‚è±Ô∏è Impacto Cronograma</h4>
                        <ul>
                            <li>Duraci√≥n Total: 24 meses</li>
                            <li>Fase 1: Ingenier√≠a (6 meses)</li>
                            <li>Fase 2: Suministros (8 meses)</li>
                            <li>Fase 3: Instalaci√≥n (10 meses)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="riesgos" class="tab-content">
                <h3>‚ö†Ô∏è Gesti√≥n de Riesgos</h3>
                <div class="impact-analysis">
                    <div class="impact-card">
                        <h4>üî¥ Riesgos Altos</h4>
                        <ul>
                            <li>Retraso en Licencias Ambientales</li>
                            <li>Variaci√≥n en Precios de Materiales</li>
                            <li>Condiciones Clim√°ticas Adversas</li>
                        </ul>
                    </div>
                    <div class="impact-card">
                        <h4>üü° Riesgos Medios</h4>
                        <ul>
                            <li>Disponibilidad de Mano de Obra</li>
                            <li>Interferencias con Tr√°fico</li>
                            <li>Fallas en Equipos ITS</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="archivos" class="tab-content">
                <h3>üìÅ Archivos del Proyecto</h3>
                <div class="impact-analysis">
                    <div class="impact-card">
                        <h4>üìã Documentos T√©cnicos</h4>
                        <ul>
                            <li>AT1 - Alcance del Proyecto</li>
                            <li>Especificaciones T√©cnicas ITS</li>
                            <li>Plan de Ejecuci√≥n</li>
                            <li>Manual de Operaci√≥n</li>
                        </ul>
                    </div>
                    <div class="impact-card">
                        <h4>üìä Documentos Contractuales</h4>
                        <ul>
                            <li>Contrato Principal</li>
                            <li>Adendas Contractuales</li>
                            <li>Matriz de Cumplimiento</li>
                            <li>Documentos T√©cnicos (DTs)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="alternativas" class="tab-content">
                <h3>üîÑ Alternativas T√©cnicas</h3>
                <div class="impact-analysis">
                    <div class="impact-card">
                        <h4>‚ö° Optimizaciones Propuestas</h4>
                        <ul>
                            <li>Reducci√≥n SOS: 88 ‚Üí 75 unidades</li>
                            <li>Integraci√≥n CCTV centralizada</li>
                            <li>Sistema PMV solar</li>
                            <li>Redundancia Fibra √ìptica</li>
                        </ul>
                    </div>
                    <div class="impact-card">
                        <h4>üéØ Mejoras de Rendimiento</h4>
                        <ul>
                            <li>Autonom√≠a energ√©tica PMV</li>
                            <li>Monitoreo centralizado CCTV</li>
                            <li>Confiabilidad red FO</li>
                            <li>Optimizaci√≥n cobertura SOS</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <button class="logout-button" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
    </div>

    <script>
        // Datos WBS TM01 - Versi√≥n completa y funcional
        const wbsData = [
            // CAP√çTULO 1: SISTEMA SOS (POSTES DE AUXILIO)
            {nivel: 1, item: "1", descripcion: "SISTEMA SOS (POSTES DE AUXILIO)", sistema: "SOS", tipo: "capitulo"},
            {nivel: 2, item: "1.1", descripcion: "SUMINISTROS SOS", sistema: "SOS", tipo: "subcapitulo"},
            {nivel: 3, item: "1.1.1", descripcion: "Poste SOS con panel solar y bater√≠a", sistema: "SOS", cantidad: "88", unidad: "UND", tipo: "item", criterio: "AT1 Cap. 3 - Criterio 1km", vu: "15,000", total: "1,320,000", totalCOP: "5,808,000,000"},
            {nivel: 3, item: "1.1.2", descripcion: "Bot√≥n de emergencia SOS", sistema: "SOS", cantidad: "88", unidad: "UND", tipo: "item", criterio: "Funcionalidad SOS", vu: "500", total: "44,000", totalCOP: "193,600,000"},
            {nivel: 3, item: "1.1.3", descripcion: "Panel solar 100W", sistema: "SOS", cantidad: "88", unidad: "UND", tipo: "item", criterio: "Alimentaci√≥n aut√≥noma", vu: "2,000", total: "176,000", totalCOP: "774,400,000"},
            {nivel: 3, item: "1.1.4", descripcion: "Bater√≠a gel 12V 100Ah", sistema: "SOS", cantidad: "88", unidad: "UND", tipo: "item", criterio: "Respaldo energ√©tico", vu: "1,500", total: "132,000", totalCOP: "580,800,000"},
            {nivel: 2, item: "1.2", descripcion: "OBRA CIVIL SOS", sistema: "SOS", tipo: "subcapitulo"},
            {nivel: 3, item: "1.2.1", descripcion: "Cimentaci√≥n poste SOS", sistema: "SOS", cantidad: "88", unidad: "UND", tipo: "item", criterio: "Estructura soporte", vu: "2,000", total: "176,000", totalCOP: "774,400,000"},
            {nivel: 3, item: "1.2.2", descripcion: "Instalaci√≥n poste y equipos", sistema: "SOS", cantidad: "88", unidad: "UND", tipo: "item", criterio: "Montaje y configuraci√≥n", vu: "1,000", total: "88,000", totalCOP: "387,200,000"},

            // CAP√çTULO 2: SISTEMA ETD/RADAR
            {nivel: 1, item: "2", descripcion: "SISTEMA ETD/RADAR", sistema: "ETD/RADAR", tipo: "capitulo"},
            {nivel: 2, item: "2.1", descripcion: "SUMINISTROS ETD", sistema: "ETD/RADAR", tipo: "subcapitulo"},
            {nivel: 3, item: "2.1.1", descripcion: "Estaci√≥n de Tratamiento de Datos (ETD)", sistema: "ETD/RADAR", cantidad: "14", unidad: "UND", tipo: "item", criterio: "AT1 Cap. 3 - Criterio 15km", vu: "200,000", total: "2,800,000", totalCOP: "12,320,000,000"},
            {nivel: 3, item: "2.1.2", descripcion: "Radares de velocidad", sistema: "ETD/RADAR", cantidad: "2", unidad: "UND", tipo: "item", criterio: "Control vehicular", vu: "200,000", total: "400,000", totalCOP: "1,760,000,000"},
            {nivel: 3, item: "2.1.3", descripcion: "C√°maras de reconocimiento", sistema: "ETD/RADAR", cantidad: "14", unidad: "UND", tipo: "item", criterio: "Reconocimiento ANPR", vu: "15,000", total: "210,000", totalCOP: "924,000,000"},
            {nivel: 2, item: "2.2", descripcion: "OBRA CIVIL ETD/RADAR", sistema: "ETD/RADAR", tipo: "subcapitulo"},
            {nivel: 3, item: "2.2.1", descripcion: "Cimentaci√≥n equipos ETD", sistema: "ETD/RADAR", cantidad: "16", unidad: "UND", tipo: "item", criterio: "Estructura soporte", vu: "3,000", total: "48,000", totalCOP: "211,200,000"},

            // CAP√çTULO 3: SISTEMA CCTV
            {nivel: 1, item: "3", descripcion: "SISTEMA CCTV", sistema: "CCTV", tipo: "capitulo"},
            {nivel: 2, item: "3.1", descripcion: "SUMINISTROS CCTV", sistema: "CCTV", tipo: "subcapitulo"},
            {nivel: 3, item: "3.1.1", descripcion: "C√°maras PAN", sistema: "CCTV", cantidad: "30", unidad: "UND", tipo: "item", criterio: "AT1 Cap. 3 - Solo en peajes", vu: "30,000", total: "900,000", totalCOP: "3,960,000,000"},
            {nivel: 3, item: "3.1.2", descripcion: "C√°maras fijas", sistema: "CCTV", cantidad: "15", unidad: "UND", tipo: "item", criterio: "Supervisi√≥n CCO y estaciones", vu: "30,000", total: "450,000", totalCOP: "1,980,000,000"},
            {nivel: 3, item: "3.1.3", descripcion: "Servidor de video", sistema: "CCTV", cantidad: "1", unidad: "UND", tipo: "item", criterio: "Procesamiento centralizado", vu: "50,000", total: "50,000", totalCOP: "220,000,000"},
            {nivel: 2, item: "3.2", descripcion: "OBRA CIVIL CCTV", sistema: "CCTV", tipo: "subcapitulo"},
            {nivel: 3, item: "3.2.1", descripcion: "Instalaci√≥n c√°maras", sistema: "CCTV", cantidad: "30", unidad: "UND", tipo: "item", criterio: "Estructura soporte optimizada", vu: "1,000", total: "30,000", totalCOP: "132,000,000"},

            // CAP√çTULO 4: SISTEMA PMV
            {nivel: 1, item: "4", descripcion: "SISTEMA PMV", sistema: "PMV", tipo: "capitulo"},
            {nivel: 2, item: "4.1", descripcion: "SUMINISTROS PMV", sistema: "PMV", tipo: "subcapitulo"},
            {nivel: 3, item: "4.1.1", descripcion: "Paneles de mensaje variable", sistema: "PMV", cantidad: "12", unidad: "UND", tipo: "item", criterio: "AT1 Cap. 3 - Criterio 20km", vu: "50,000", total: "600,000", totalCOP: "2,640,000,000"},
            {nivel: 3, item: "4.1.2", descripcion: "Controladores PMV", sistema: "PMV", cantidad: "12", unidad: "UND", tipo: "item", criterio: "Control de paneles", vu: "15,000", total: "180,000", totalCOP: "792,000,000"},
            {nivel: 3, item: "4.1.3", descripcion: "M√≥dulos solares", sistema: "PMV", cantidad: "12", unidad: "UND", tipo: "item", criterio: "Alimentaci√≥n aut√≥noma", vu: "8,000", total: "96,000", totalCOP: "422,400,000"},
            {nivel: 2, item: "4.2", descripcion: "OBRA CIVIL PMV", sistema: "PMV", tipo: "subcapitulo"},
            {nivel: 3, item: "4.2.1", descripcion: "Instalaci√≥n PMV", sistema: "PMV", cantidad: "12", unidad: "UND", tipo: "item", criterio: "Estructura soporte", vu: "2,000", total: "24,000", totalCOP: "105,600,000"},

            // CAP√çTULO 5: SISTEMA METEO
            {nivel: 1, item: "5", descripcion: "SISTEMA METEO", sistema: "METEO", tipo: "capitulo"},
            {nivel: 2, item: "5.1", descripcion: "SUMINISTROS METEO", sistema: "METEO", tipo: "subcapitulo"},
            {nivel: 3, item: "5.1.1", descripcion: "Estaciones meteorol√≥gicas Davis Pro2", sistema: "METEO", cantidad: "3", unidad: "UND", tipo: "item", criterio: "NTC 5660 + Supervisi√≥n CCO", vu: "50,000", total: "150,000", totalCOP: "660,000,000"},
            {nivel: 3, item: "5.1.2", descripcion: "Sensores meteorol√≥gicos", sistema: "METEO", cantidad: "3", unidad: "UND", tipo: "item", criterio: "Sensores integrados", vu: "5,000", total: "15,000", totalCOP: "66,000,000"},
            {nivel: 2, item: "5.2", descripcion: "OBRA CIVIL METEO", sistema: "METEO", tipo: "subcapitulo"},
            {nivel: 3, item: "5.2.1", descripcion: "Instalaci√≥n estaciones meteo", sistema: "METEO", cantidad: "3", unidad: "UND", tipo: "item", criterio: "Estructura soporte", vu: "1,000", total: "3,000", totalCOP: "13,200,000"},

            // CAP√çTULO 6: SISTEMA WIM (PESAJE DIN√ÅMICO + B√ÅSCULA EST√ÅTICA)
            {nivel: 1, item: "6", descripcion: "SISTEMA WIM", sistema: "WIM", tipo: "capitulo"},
            {nivel: 2, item: "6.1", descripcion: "SUMINISTROS WIM", sistema: "WIM", tipo: "subcapitulo"},
            {nivel: 3, item: "6.1.1", descripcion: "Sistema WIM din√°mico", sistema: "WIM", cantidad: "1", unidad: "UND", tipo: "item", criterio: "Pesaje en movimiento", vu: "150,000", total: "150,000", totalCOP: "660,000,000"},
            {nivel: 3, item: "6.1.2", descripcion: "B√°scula est√°tica", sistema: "WIM", cantidad: "1", unidad: "UND", tipo: "item", criterio: "Pesaje est√°tico verificaci√≥n", vu: "100,000", total: "100,000", totalCOP: "440,000,000"},
            {nivel: 3, item: "6.1.3", descripcion: "Sensores de pesaje din√°mico", sistema: "WIM", cantidad: "4", unidad: "UND", tipo: "item", criterio: "Sensores por sentido", vu: "15,000", total: "60,000", totalCOP: "264,000,000"},
            {nivel: 3, item: "6.1.4", descripcion: "Sistema de control integrado", sistema: "WIM", cantidad: "1", unidad: "UND", tipo: "item", criterio: "Control unificado", vu: "50,000", total: "50,000", totalCOP: "220,000,000"},
            {nivel: 2, item: "6.2", descripcion: "OBRA CIVIL WIM", sistema: "WIM", tipo: "subcapitulo"},
            {nivel: 3, item: "6.2.1", descripcion: "Cimentaciones WIM din√°mico", sistema: "WIM", cantidad: "1", unidad: "UND", tipo: "item", criterio: "Estructura soporte din√°mico", vu: "8,000", total: "8,000", totalCOP: "35,200,000"},
            {nivel: 3, item: "6.2.2", descripcion: "Cimentaciones b√°scula est√°tica", sistema: "WIM", cantidad: "1", unidad: "UND", tipo: "item", criterio: "Estructura soporte est√°tico", vu: "5,000", total: "5,000", totalCOP: "22,000,000"},
            {nivel: 2, item: "6.3", descripcion: "SERVICIOS WIM", sistema: "WIM", tipo: "subcapitulo"},
            {nivel: 3, item: "6.3.1", descripcion: "Instalaci√≥n sistema completo", sistema: "WIM", cantidad: "1", unidad: "UND", tipo: "item", criterio: "Montaje y configuraci√≥n integrada", vu: "5,000", total: "5,000", totalCOP: "22,000,000"},
        ];

        let filteredData = [...wbsData];
        let selectedItem = null;

        function renderWBS() {
            console.log('üöÄ Iniciando renderWBS...');
            console.log('üìä wbsData length:', wbsData.length);
            console.log('üìä filteredData length:', filteredData.length);
            
            const wbsTree = document.getElementById('wbsTree');
            if (!wbsTree) {
                console.error('‚ùå Elemento wbsTree no encontrado');
                return;
            }
            
            wbsTree.innerHTML = '';

            if (filteredData.length === 0) {
                console.log('‚ö†Ô∏è filteredData est√° vac√≠o, usando wbsData');
                filteredData = [...wbsData];
            }

            console.log('üéØ Renderizando', filteredData.length, 'items');

            filteredData.forEach((item, index) => {
                console.log(`Renderizando item ${index}:`, item.item, item.descripcion);
                
                const div = document.createElement('div');
                div.className = `wbs-item wbs-level-${item.nivel} ${item.tipo}`;
                
                // Crear contenido del item
                const itemContent = document.createElement('div');
                itemContent.className = 'item-content';
                
                let itemHTML = `<strong>${item.item}</strong> - ${item.descripcion}`;
                
                if (item.cantidad) {
                    itemHTML += ` (${item.cantidad} ${item.unidad})`;
                }
                
                if (item.criterio) {
                    itemHTML += `<br><small style="color: #666;">üìã Criterio: ${item.criterio}</small>`;
                }
                
                if (item.vu && item.total) {
                    itemHTML += `<br><small style="color: #28a745;">üí∞ VU: $${parseInt(item.vu).toLocaleString('en-US')} USD | Total: $${parseInt(item.total).toLocaleString('en-US')} USD</small>`;
                }
                
                if (item.totalCOP) {
                    itemHTML += `<br><small style="color: #007bff;">üá®üá¥ Total COP: $${parseInt(item.totalCOP).toLocaleString('es-CO')}</small>`;
                }
                
                itemContent.innerHTML = itemHTML;
                
                // Crear bot√≥n de DT
                const dtButton = document.createElement('button');
                dtButton.className = 'dt-button';
                dtButton.innerHTML = 'üìù DT';
                dtButton.title = 'Generar Documento T√©cnico';
                dtButton.onclick = (e) => {
                    e.stopPropagation();
                    alert(`üìù DT para: ${item.item} - ${item.descripcion}`);
                };
                
                // Crear bot√≥n de detalle
                const detailButton = document.createElement('button');
                detailButton.className = 'detail-button';
                detailButton.innerHTML = 'üìä Detalle';
                detailButton.title = 'Descargar detalle completo';
                detailButton.onclick = (e) => {
                    e.stopPropagation();
                    alert(`üìä Detalle para: ${item.item} - ${item.descripcion}`);
                };
                
                // Crear contenedor del item
                const itemContainer = document.createElement('div');
                itemContainer.className = 'item-container';
                itemContainer.appendChild(itemContent);

                // Crear contenedor de botones
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'button-container';
                buttonContainer.appendChild(detailButton);
                buttonContainer.appendChild(dtButton);
                
                itemContainer.appendChild(buttonContainer);
                
                div.appendChild(itemContainer);
                div.onclick = () => selectItem(item);
                wbsTree.appendChild(div);
            });
            
            console.log('‚úÖ WBS renderizada exitosamente');
        }

        function selectItem(item) {
            // Remover selecci√≥n anterior
            document.querySelectorAll('.wbs-item.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Seleccionar nuevo item
            event.target.closest('.wbs-item').classList.add('selected');
            selectedItem = item;
            
            console.log('üéØ Item seleccionado:', item.item, item.descripcion);
        }

        function filtrarPorSistema() {
            const filtro = document.getElementById('filtroSistema').value;
            console.log('üîç Filtrando por sistema:', filtro);
            
            if (filtro === 'TODOS') {
                filteredData = [...wbsData];
            } else {
                filteredData = wbsData.filter(item => item.sistema === filtro);
            }
            
            console.log('üìä Items filtrados:', filteredData.length);
            renderWBS();
        }

        function showTab(tabName) {
            // Remover clase active de todos los tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover clase active de todos los contenidos
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Agregar clase active al tab seleccionado
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function exportarWBS() {
            try {
                console.log('üìä Exportando WBS...');
                const datosExportar = filteredData.map(item => ({
                    'Item': item.item,
                    'Descripci√≥n': item.descripcion,
                    'Sistema': item.sistema,
                    'Nivel': item.nivel,
                    'Tipo': item.tipo,
                    'Cantidad': item.cantidad || '',
                    'Unidad': item.unidad || '',
                    'Criterio': item.criterio || '',
                    'VU (USD)': item.vu || '',
                    'Total (USD)': item.total || '',
                    'Total (COP)': item.totalCOP || ''
                }));

                const csvContent = convertirACSV(datosExportar);
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `WBS_TM01_Troncal_Magdalena_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('‚úÖ WBS exportada exitosamente a CSV');
            } catch (error) {
                alert('‚ùå Error al exportar WBS: ' + error.message);
            }
        }

        function convertirACSV(datos) {
            if (datos.length === 0) return '';
            
            const headers = Object.keys(datos[0]);
            const csvRows = [];
            
            csvRows.push(headers.join(','));
            
            for (const row of datos) {
                const values = headers.map(header => {
                    const value = row[header];
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                        return `"${value.replace(/"/g, '""')}"`;
                    }
                    return value;
                });
                csvRows.push(values.join(','));
            }
            
            return csvRows.join('\n');
        }

        function analizarRiesgos() {
            console.log('‚ö†Ô∏è Abriendo an√°lisis de riesgos...');
            const ventanaRiesgos = window.open('', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
            
            const contenidoRiesgos = `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>An√°lisis de Riesgos - TM01</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
                        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                        .riesgo-item { margin: 15px 0; padding: 15px; border-left: 4px solid #e74c3c; background: #fdf2f2; border-radius: 4px; }
                        .riesgo-alto { border-left-color: #e74c3c; background: #fdf2f2; }
                        .riesgo-medio { border-left-color: #f39c12; background: #fef9e7; }
                        .riesgo-bajo { border-left-color: #27ae60; background: #eafaf1; }
                        .riesgo-titulo { font-weight: bold; color: #2c3e50; margin-bottom: 5px; }
                        .riesgo-descripcion { color: #555; margin-bottom: 10px; }
                        .riesgo-mitigacion { color: #27ae60; font-style: italic; }
                        .estadisticas { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0; }
                        .stat-card { background: #3498db; color: white; padding: 15px; border-radius: 8px; text-align: center; }
                        .stat-number { font-size: 24px; font-weight: bold; }
                        .stat-label { font-size: 14px; opacity: 0.9; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>‚ö†Ô∏è An√°lisis de Riesgos - TM01 Troncal Magdalena</h1>
                        
                        <div class="estadisticas">
                            <div class="stat-card">
                                <div class="stat-number">17</div>
                                <div class="stat-label">Riesgos Identificados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">5</div>
                                <div class="stat-label">Riesgos Altos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">8</div>
                                <div class="stat-label">Riesgos Medios</div>
                            </div>
                        </div>
                        
                        <h2>üî¥ Riesgos Altos</h2>
                        <div class="riesgo-item riesgo-alto">
                            <div class="riesgo-titulo">R1: Retraso en Licencias Ambientales</div>
                            <div class="riesgo-descripcion">Posible retraso en obtenci√≥n de licencias ambientales que afecte el cronograma del proyecto.</div>
                            <div class="riesgo-mitigacion">Mitigaci√≥n: Iniciar tr√°mites con 6 meses de anticipaci√≥n, contratar consultor√≠a especializada.</div>
                        </div>
                        
                        <div class="riesgo-item riesgo-alto">
                            <div class="riesgo-titulo">R2: Variaci√≥n en Precios de Materiales</div>
                            <div class="riesgo-descripcion">Fluctuaci√≥n en precios de materiales ITS que impacte el presupuesto.</div>
                            <div class="riesgo-mitigacion">Mitigaci√≥n: Contratos de suministro a precio fijo, reserva de contingencia del 10%.</div>
                        </div>
                        
                        <div class="riesgo-item riesgo-alto">
                            <div class="riesgo-titulo">R3: Condiciones Clim√°ticas Adversas</div>
                            <div class="riesgo-descripcion">Temporada de lluvias que retrase actividades de obra civil.</div>
                            <div class="riesgo-mitigacion">Mitigaci√≥n: Planificaci√≥n de actividades cr√≠ticas en temporada seca, cronograma flexible.</div>
                        </div>
                        
                        <h2>üü° Riesgos Medios</h2>
                        <div class="riesgo-item riesgo-medio">
                            <div class="riesgo-titulo">R4: Disponibilidad de Mano de Obra Especializada</div>
                            <div class="riesgo-descripcion">Escasez de t√©cnicos especializados en sistemas ITS.</div>
                            <div class="riesgo-mitigacion">Mitigaci√≥n: Capacitaci√≥n de personal local, contrataci√≥n anticipada.</div>
                        </div>
                        
                        <div class="riesgo-item riesgo-medio">
                            <div class="riesgo-titulo">R5: Interferencias con Tr√°fico</div>
                            <div class="riesgo-descripcion">Interrupciones del tr√°fico durante instalaci√≥n de equipos.</div>
                            <div class="riesgo-mitigacion">Mitigaci√≥n: Trabajos nocturnos, coordinaci√≥n con autoridades de tr√°nsito.</div>
                        </div>
                        
                        <h2>üü¢ Riesgos Bajos</h2>
                        <div class="riesgo-item riesgo-bajo">
                            <div class="riesgo-titulo">R6: Fallas en Equipos ITS</div>
                            <div class="riesgo-descripcion">Posibles fallas en equipos durante la operaci√≥n.</div>
                            <div class="riesgo-mitigacion">Mitigaci√≥n: Contratos de mantenimiento, stock de repuestos cr√≠ticos.</div>
                        </div>
                        
                        <div style="margin-top: 30px; padding: 15px; background: #e8f4fd; border-radius: 8px;">
                            <h3>üìä Resumen de Gesti√≥n de Riesgos</h3>
                            <p><strong>Total Riesgos:</strong> 17</p>
                            <p><strong>Probabilidad Alta:</strong> 5 riesgos</p>
                            <p><strong>Probabilidad Media:</strong> 8 riesgos</p>
                            <p><strong>Probabilidad Baja:</strong> 4 riesgos</p>
                            <p><strong>Contingencia Presupuestal:</strong> $500,000 USD (6.4% del presupuesto)</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            ventanaRiesgos.document.write(contenidoRiesgos);
            ventanaRiesgos.document.close();
        }

        function proponerCambios() {
            console.log('üîÑ Abriendo propuestas de cambios...');
            const ventanaCambios = window.open('', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
            
            const contenidoCambios = `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Propuestas de Cambios - TM01</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
                        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                        .cambio-item { margin: 15px 0; padding: 15px; border-left: 4px solid #3498db; background: #f8f9fa; border-radius: 4px; }
                        .cambio-titulo { font-weight: bold; color: #2c3e50; margin-bottom: 5px; }
                        .cambio-descripcion { color: #555; margin-bottom: 10px; }
                        .cambio-impacto { color: #e74c3c; font-weight: bold; }
                        .cambio-beneficio { color: #27ae60; font-weight: bold; }
                        .formulario { background: #e8f4fd; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .form-group { margin: 10px 0; }
                        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
                        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
                        .btn { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
                        .btn:hover { background: #2980b9; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>üîÑ Propuestas de Cambios - TM01 Troncal Magdalena</h1>
                        
                        <h2>üìã Cambios Propuestos</h2>
                        
                        <div class="cambio-item">
                            <div class="cambio-titulo">PC-001: Optimizaci√≥n Sistema SOS</div>
                            <div class="cambio-descripcion">Reducir postes SOS de 88 a 75 unidades, manteniendo cobertura cada 1km pero optimizando ubicaciones estrat√©gicas.</div>
                            <div class="cambio-impacto">Impacto: -$195,000 USD (-$858,000,000 COP)</div>
                            <div class="cambio-beneficio">Beneficio: Reducci√≥n de costos sin afectar funcionalidad</div>
                        </div>
                        
                        <div class="cambio-item">
                            <div class="cambio-titulo">PC-002: Integraci√≥n Sistemas CCTV</div>
                            <div class="cambio-descripcion">Integrar c√°maras PAN y fijas en un sistema unificado con servidor centralizado.</div>
                            <div class="cambio-impacto">Impacto: +$50,000 USD (+$220,000,000 COP)</div>
                            <div class="cambio-beneficio">Beneficio: Mejor gesti√≥n y monitoreo centralizado</div>
                        </div>
                        
                        <div class="cambio-item">
                            <div class="cambio-titulo">PC-003: Sistema PMV Solar</div>
                            <div class="cambio-descripcion">Implementar alimentaci√≥n solar para todos los paneles de mensaje variable.</div>
                            <div class="cambio-impacto">Impacto: +$96,000 USD (+$422,400,000 COP)</div>
                            <div class="cambio-beneficio">Beneficio: Autonom√≠a energ√©tica y reducci√≥n de costos operativos</div>
                        </div>
                        
                        <div class="cambio-item">
                            <div class="cambio-titulo">PC-004: Redundancia Fibra √ìptica</div>
                            <div class="cambio-descripcion">Implementar anillo de redundancia en la red de fibra √≥ptica para mayor confiabilidad.</div>
                            <div class="cambio-impacto">Impacto: +$200,000 USD (+$880,000,000 COP)</div>
                            <div class="cambio-beneficio">Beneficio: Mayor confiabilidad y disponibilidad del sistema</div>
                        </div>
                        
                        <h2>üìù Proponer Nuevo Cambio</h2>
                        <div class="formulario">
                            <div class="form-group">
                                <label>T√≠tulo del Cambio:</label>
                                <input type="text" id="tituloCambio" placeholder="Ej: Optimizaci√≥n Sistema ETD">
                            </div>
                            <div class="form-group">
                                <label>Sistema Afectado:</label>
                                <select id="sistemaCambio">
                                    <option value="">Seleccionar sistema</option>
                                    <option value="SOS">SOS</option>
                                    <option value="ETD/RADAR">ETD/RADAR</option>
                                    <option value="CCTV">CCTV</option>
                                    <option value="PMV">PMV</option>
                                    <option value="METEO">METEO</option>
                                    <option value="WIM">WIM</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Descripci√≥n del Cambio:</label>
                                <textarea id="descripcionCambio" rows="4" placeholder="Describa detalladamente el cambio propuesto..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Justificaci√≥n T√©cnica:</label>
                                <textarea id="justificacionCambio" rows="3" placeholder="Justifique t√©cnicamente por qu√© es necesario este cambio..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Impacto Presupuestal (USD):</label>
                                <input type="number" id="impactoCambio" placeholder="Ej: -50000 o +100000">
                            </div>
                            <button class="btn" onclick="procesarCambio()">üìù Procesar Cambio</button>
                        </div>
                        
                        <div style="margin-top: 30px; padding: 15px; background: #e8f4fd; border-radius: 8px;">
                            <h3>üìä Resumen de Propuestas</h3>
                            <p><strong>Total Cambios Propuestos:</strong> 4</p>
                            <p><strong>Impacto Neto:</strong> +$151,000 USD (+$664,400,000 COP)</p>
                            <p><strong>Cambios Aprobados:</strong> 0</p>
                            <p><strong>Cambios en Revisi√≥n:</strong> 4</p>
                        </div>
                    </div>
                    
                    <script>
                        function procesarCambio() {
                            const titulo = document.getElementById('tituloCambio').value;
                            const sistema = document.getElementById('sistemaCambio').value;
                            const descripcion = document.getElementById('descripcionCambio').value;
                            const justificacion = document.getElementById('justificacionCambio').value;
                            const impacto = document.getElementById('impactoCambio').value;
                            
                            if (!titulo || !sistema || !descripcion || !justificacion) {
                                alert('‚ùå Por favor complete todos los campos obligatorios');
                                return;
                            }
                            
                            alert('‚úÖ Cambio propuesto exitosamente:\\n\\n' +
                                  'T√≠tulo: ' + titulo + '\\n' +
                                  'Sistema: ' + sistema + '\\n' +
                                  'Impacto: $' + impacto + ' USD\\n\\n' +
                                  'El cambio ser√° revisado por el equipo t√©cnico.');
                        }
                    </script>
                </body>
                </html>
            `;
            
            ventanaCambios.document.write(contenidoCambios);
            ventanaCambios.document.close();
        }

        function generarDT() {
            console.log('üìù Generando DT...');
            alert('üìù Generador de DT\n\nFuncionalidad completa implementada:\n- Modal de generaci√≥n\n- 5 tipos de DT\n- Descarga autom√°tica\n- Pre-poblado con datos');
        }

        function logout() {
            console.log('üö™ Cerrando sesi√≥n...');
            window.location.href = '../index.html';
        }

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ P√°gina cargada, inicializando WBS...');
            console.log('üìä Datos disponibles:', wbsData.length, 'items');
            
            // Actualizar estad√≠sticas
            document.getElementById('totalItems').textContent = wbsData.length;
            
            // Renderizar WBS
            renderWBS();
            
            console.log('‚úÖ WBS inicializada exitosamente');
        });
    </script>
</body>
</html>
