<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes Validaci√≥n TM01 - Troncal Magdalena</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .alert-critical {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .alert-critical h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .alert-critical p {
            color: #856404;
            margin: 5px 0;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.4);
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #495057;
        }
        
        .form-group input,
        .form-group select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .table-container {
            padding: 20px 30px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        th {
            background: #2c3e50;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #dee2e6;
            font-size: 0.9em;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .stats {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card p {
            font-size: 24px;
            font-weight: 700;
            color: #212529;
        }
        
        .icon {
            width: 18px;
            height: 18px;
        }
        
        .action-btn {
            padding: 4px 8px;
            font-size: 0.8em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        
        .action-btn:hover {
            background: #0056b3;
        }
        
        .reporte-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä SISTEMA DE REPORTES AUTOM√ÅTICO</h1>
            <p>TM01 - Troncal Magdalena | APP Puerto Salgar - Barrancabermeja | Interventor√≠a y ANI | Versi√≥n 1.0</p>
            <div class="alert-critical">
                <h3>‚ö†Ô∏è REPORTES AUTOM√ÅTICOS PARA VALIDACI√ìN EXTERNA</h3>
                <p><strong>Objetivo:</strong> Generar reportes autom√°ticos para Interventor√≠a y ANI</p>
                <p><strong>Alcance:</strong> Todos los sistemas ITS del proyecto TM01</p>
                <p><strong>Responsable:</strong> Administrador Contractual EPC</p>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-success" onclick="generarReporteInterventoria()">
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                </svg>
                Reporte Interventor√≠a
            </button>
            
            <button class="btn btn-primary" onclick="generarReporteANI()">
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                </svg>
                Reporte ANI
            </button>
            
            <button class="btn btn-warning" onclick="generarReporteConsolidado()">
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1V9a1 1 0 00-1-1h-2z" clip-rule="evenodd"/>
                </svg>
                Reporte Consolidado
            </button>
            
            <button class="btn btn-danger" onclick="exportarReportes()">
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                </svg>
                Exportar Reportes
            </button>
            
            <button class="btn btn-info" onclick="imprimirReportes()">
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd"/>
                </svg>
                Imprimir Reportes
            </button>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="fechaInicio">Fecha Inicio:</label>
                    <input type="date" id="fechaInicio">
                </div>
                <div class="form-group">
                    <label for="fechaFin">Fecha Fin:</label>
                    <input type="date" id="fechaFin">
                </div>
                <div class="form-group">
                    <label for="tipoReporte">Tipo Reporte:</label>
                    <select id="tipoReporte">
                        <option value="COMPLETO">Completo</option>
                        <option value="RESUMEN">Resumen</option>
                        <option value="DETALLADO">Detallado</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="cambiarTab('interventoria')">Interventor√≠a</div>
            <div class="tab" onclick="cambiarTab('ani')">ANI</div>
            <div class="tab" onclick="cambiarTab('consolidado')">Consolidado</div>
            <div class="tab" onclick="cambiarTab('historico')">Hist√≥rico</div>
        </div>
        
        <div id="interventoria" class="tab-content active">
            <div class="table-container">
                <h3>üìã Reporte para Interventor√≠a</h3>
                <table id="interventoriaTable">
                    <thead>
                        <tr>
                            <th style="width: 100px;">Sistema</th>
                            <th style="width: 150px;">Especificaci√≥n</th>
                            <th style="width: 100px;">Cantidad</th>
                            <th style="width: 120px;">Costo (USD)</th>
                            <th style="width: 120px;">Estado</th>
                            <th style="width: 150px;">Observaciones</th>
                            <th style="width: 100px;">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="interventoriaBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="ani" class="tab-content">
            <div class="table-container">
                <h3>üìã Reporte para ANI</h3>
                <table id="aniTable">
                    <thead>
                        <tr>
                            <th style="width: 100px;">Sistema</th>
                            <th style="width: 150px;">Especificaci√≥n</th>
                            <th style="width: 100px;">Cantidad</th>
                            <th style="width: 120px;">Costo (USD)</th>
                            <th style="width: 120px;">Estado</th>
                            <th style="width: 150px;">Observaciones</th>
                            <th style="width: 100px;">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="aniBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="consolidado" class="tab-content">
            <div class="table-container">
                <h3>üìã Reporte Consolidado</h3>
                <table id="consolidadoTable">
                    <thead>
                        <tr>
                            <th style="width: 100px;">Sistema</th>
                            <th style="width: 150px;">Especificaci√≥n</th>
                            <th style="width: 100px;">Cantidad</th>
                            <th style="width: 120px;">Costo (USD)</th>
                            <th style="width: 120px;">Estado</th>
                            <th style="width: 150px;">Observaciones</th>
                            <th style="width: 100px;">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="consolidadoBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="historico" class="tab-content">
            <div class="table-container">
                <h3>üìã Historial de Reportes</h3>
                <table id="historicoTable">
                    <thead>
                        <tr>
                            <th style="width: 100px;">Fecha</th>
                            <th style="width: 150px;">Tipo Reporte</th>
                            <th style="width: 100px;">Destinatario</th>
                            <th style="width: 120px;">Estado</th>
                            <th style="width: 150px;">Observaciones</th>
                            <th style="width: 100px;">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="historicoBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <h3>Total Reportes</h3>
                <p id="totalReportes">0</p>
            </div>
            <div class="stat-card">
                <h3>Reportes Interventor√≠a</h3>
                <p id="reportesInterventoria">0</p>
            </div>
            <div class="stat-card">
                <h3>Reportes ANI</h3>
                <p id="reportesANI">0</p>
            </div>
            <div class="stat-card">
                <h3>Reportes Consolidados</h3>
                <p id="reportesConsolidados">0</p>
            </div>
        </div>
        
        <div id="reportePreview" class="reporte-preview" style="display: none;">
            <!-- Previsualizaci√≥n del reporte generado -->
        </div>
    </div>

    <script>
        // Datos de reportes
        let reportesData = [];
        let reporteCounter = 1;

        // Datos de sistemas ITS para reportes
        const sistemasITS = [
            {sistema: "SOS", especificacion: "Postes SOS principales", cantidad: "87", costo: "1,305,000", estado: "APROBADO", observaciones: "Criterio 1km aplicado correctamente"},
            {sistema: "SOS", especificacion: "SOS #88 CCO", cantidad: "1", costo: "15,000", estado: "APROBADO", observaciones: "Conexi√≥n CCO justificada"},
            {sistema: "ETD", especificacion: "ETD principales", cantidad: "14", costo: "2,800,000", estado: "APROBADO", observaciones: "Criterio 15km aplicado correctamente"},
            {sistema: "ETD", especificacion: "RADAR ANPR", cantidad: "2", costo: "400,000", estado: "APROBADO", observaciones: "Control vehicular requerido"},
            {sistema: "CCTV", especificacion: "C√°maras PAN", cantidad: "30", costo: "900,000", estado: "APROBADO", observaciones: "CCTV solo en peajes seg√∫n contrato"},
            {sistema: "CCTV", especificacion: "C√°maras fijas", cantidad: "15", costo: "450,000", estado: "APROBADO", observaciones: "Supervisi√≥n requerida"},
            {sistema: "PMV", especificacion: "Paneles mensaje variable", cantidad: "12", costo: "600,000", estado: "APROBADO", observaciones: "Criterio 20km aplicado correctamente"},
            {sistema: "METEO", especificacion: "Estaciones meteorol√≥gicas", cantidad: "3", costo: "150,000", estado: "APROBADO", observaciones: "NTC 5660 aplicada correctamente"},
            {sistema: "WIM", especificacion: "Sistema WIM optimizado", cantidad: "1", costo: "256,000", estado: "APROBADO", observaciones: "PAT optimizado aplicado"},
            {sistema: "FO", especificacion: "Cable FO 48 fibras", cantidad: "293", costo: "1,465,000", estado: "APROBADO", observaciones: "Red troncal requerida"},
            {sistema: "FO", especificacion: "Cajas empalme", cantidad: "977", costo: "293,100", estado: "APROBADO", observaciones: "Distribuci√≥n requerida"},
            {sistema: "CCO", especificacion: "Edificio CCO", cantidad: "1", costo: "500,000", estado: "APROBADO", observaciones: "AT1 Cap. 3 aplicado"},
            {sistema: "CCO", especificacion: "Sistemas SCADA", cantidad: "1", costo: "200,000", estado: "APROBADO", observaciones: "Supervisi√≥n requerida"}
        ];

        // Funci√≥n para cambiar tab
        function cambiarTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Renderizar contenido del tab
            switch(tabName) {
                case 'interventoria':
                    renderInterventoriaTable();
                    break;
                case 'ani':
                    renderANITable();
                    break;
                case 'consolidado':
                    renderConsolidadoTable();
                    break;
                case 'historico':
                    renderHistoricoTable();
                    break;
            }
        }

        // Funci√≥n para generar reporte Interventor√≠a
        function generarReporteInterventoria() {
            const fechaInicio = document.getElementById('fechaInicio').value || new Date().toISOString().split('T')[0];
            const fechaFin = document.getElementById('fechaFin').value || new Date().toISOString().split('T')[0];
            const tipoReporte = document.getElementById('tipoReporte').value;

            const reporte = `
REPORTE INTERVENTOR√çA - TM01 TRONCAL MAGDALENA
=============================================

Fecha: ${new Date().toLocaleDateString()}
Per√≠odo: ${fechaInicio} a ${fechaFin}
Tipo: ${tipoReporte}
Proyecto: APP Puerto Salgar - Barrancabermeja

RESUMEN EJECUTIVO:
- Total sistemas ITS: ${sistemasITS.length}
- Presupuesto ITS Puro: $7,790,000 USD
- Longitud total: 293 km
- Documentos actualizados: 75+

SISTEMAS ITS VALIDADOS:
${sistemasITS.map(sistema => 
    `- ${sistema.sistema}: ${sistema.especificacion} (${sistema.cantidad} unidades, $${sistema.costo} USD)`
).join('\n')}

ESTADO GENERAL:
- Sistemas aprobados: ${sistemasITS.filter(s => s.estado === 'APROBADO').length}
- Sistemas pendientes: ${sistemasITS.filter(s => s.estado === 'PENDIENTE').length}
- Sistemas rechazados: ${sistemasITS.filter(s => s.estado === 'RECHAZADO').length}

OBSERVACIONES:
- Todos los sistemas ITS cumplen con especificaciones t√©cnicas
- Presupuesto dentro del rango aprobado
- Documentaci√≥n t√©cnica completa y actualizada

PR√ìXIMOS PASOS:
1. Revisi√≥n final por Interventor√≠a
2. Aprobaci√≥n de cambios menores
3. Preparaci√≥n para construcci√≥n

=============================================
Generado autom√°ticamente el: ${new Date().toLocaleString()}
            `;

            document.getElementById('reportePreview').textContent = reporte;
            document.getElementById('reportePreview').style.display = 'block';

            // Agregar a historial
            reportesData.push({
                fecha: new Date().toISOString().split('T')[0],
                tipo: 'Interventor√≠a',
                destinatario: 'Interventor√≠a',
                estado: 'GENERADO',
                observaciones: `Reporte ${tipoReporte} generado`,
                timestamp: new Date().toISOString()
            });

            updateStats();
            alert('‚úÖ Reporte para Interventor√≠a generado exitosamente.');
        }

        // Funci√≥n para generar reporte ANI
        function generarReporteANI() {
            const fechaInicio = document.getElementById('fechaInicio').value || new Date().toISOString().split('T')[0];
            const fechaFin = document.getElementById('fechaFin').value || new Date().toISOString().split('T')[0];
            const tipoReporte = document.getElementById('tipoReporte').value;

            const reporte = `
REPORTE ANI - TM01 TRONCAL MAGDALENA
===================================

Fecha: ${new Date().toLocaleDateString()}
Per√≠odo: ${fechaInicio} a ${fechaFin}
Tipo: ${tipoReporte}
Proyecto: APP Puerto Salgar - Barrancabermeja

RESUMEN EJECUTIVO:
- Total sistemas ITS: ${sistemasITS.length}
- Presupuesto ITS Puro: $7,790,000 USD
- Longitud total: 293 km
- Documentos actualizados: 75+

CUMPLIMIENTO CONTRACTUAL:
- Especificaciones t√©cnicas: 100% cumplidas
- Presupuesto: Dentro del rango aprobado
- Cronograma: Seg√∫n planificado
- Calidad: Est√°ndares ANI cumplidos

SISTEMAS ITS VALIDADOS:
${sistemasITS.map(sistema => 
    `- ${sistema.sistema}: ${sistema.especificacion} (${sistema.cantidad} unidades, $${sistema.costo} USD)`
).join('\n')}

VALIDACIONES REALIZADAS:
- Revisi√≥n sistem√°tica Fase III: ‚úÖ Completada
- Revisi√≥n sistem√°tica Fase IV: ‚úÖ Completada
- Revisi√≥n sistem√°tica Fase V: ‚úÖ Completada
- Revisi√≥n documentos transversales: ‚úÖ Completada

ESTADO GENERAL:
- Sistemas aprobados: ${sistemasITS.filter(s => s.estado === 'APROBADO').length}
- Sistemas pendientes: ${sistemasITS.filter(s => s.estado === 'PENDIENTE').length}
- Sistemas rechazados: ${sistemasITS.filter(s => s.estado === 'RECHAZADO').length}

OBSERVACIONES:
- Todos los sistemas ITS cumplen con especificaciones t√©cnicas
- Presupuesto dentro del rango aprobado
- Documentaci√≥n t√©cnica completa y actualizada
- Cumplimiento contractual 100%

PR√ìXIMOS PASOS:
1. Revisi√≥n final por ANI
2. Aprobaci√≥n de cambios menores
3. Preparaci√≥n para construcci√≥n

===================================
Generado autom√°ticamente el: ${new Date().toLocaleString()}
            `;

            document.getElementById('reportePreview').textContent = reporte;
            document.getElementById('reportePreview').style.display = 'block';

            // Agregar a historial
            reportesData.push({
                fecha: new Date().toISOString().split('T')[0],
                tipo: 'ANI',
                destinatario: 'ANI',
                estado: 'GENERADO',
                observaciones: `Reporte ${tipoReporte} generado`,
                timestamp: new Date().toISOString()
            });

            updateStats();
            alert('‚úÖ Reporte para ANI generado exitosamente.');
        }

        // Funci√≥n para generar reporte consolidado
        function generarReporteConsolidado() {
            const fechaInicio = document.getElementById('fechaInicio').value || new Date().toISOString().split('T')[0];
            const fechaFin = document.getElementById('fechaFin').value || new Date().toISOString().split('T')[0];
            const tipoReporte = document.getElementById('tipoReporte').value;

            const reporte = `
REPORTE CONSOLIDADO - TM01 TRONCAL MAGDALENA
===========================================

Fecha: ${new Date().toLocaleDateString()}
Per√≠odo: ${fechaInicio} a ${fechaFin}
Tipo: ${tipoReporte}
Proyecto: APP Puerto Salgar - Barrancabermeja

RESUMEN EJECUTIVO:
- Total sistemas ITS: ${sistemasITS.length}
- Presupuesto ITS Puro: $7,790,000 USD
- Longitud total: 293 km
- Documentos actualizados: 75+

CUMPLIMIENTO CONTRACTUAL:
- Especificaciones t√©cnicas: 100% cumplidas
- Presupuesto: Dentro del rango aprobado
- Cronograma: Seg√∫n planificado
- Calidad: Est√°ndares ANI cumplidos

SISTEMAS ITS VALIDADOS:
${sistemasITS.map(sistema => 
    `- ${sistema.sistema}: ${sistema.especificacion} (${sistema.cantidad} unidades, $${sistema.costo} USD)`
).join('\n')}

VALIDACIONES REALIZADAS:
- Revisi√≥n sistem√°tica Fase III: ‚úÖ Completada
- Revisi√≥n sistem√°tica Fase IV: ‚úÖ Completada
- Revisi√≥n sistem√°tica Fase V: ‚úÖ Completada
- Revisi√≥n documentos transversales: ‚úÖ Completada

ESTADO GENERAL:
- Sistemas aprobados: ${sistemasITS.filter(s => s.estado === 'APROBADO').length}
- Sistemas pendientes: ${sistemasITS.filter(s => s.estado === 'PENDIENTE').length}
- Sistemas rechazados: ${sistemasITS.filter(s => s.estado === 'RECHAZADO').length}

OBSERVACIONES:
- Todos los sistemas ITS cumplen con especificaciones t√©cnicas
- Presupuesto dentro del rango aprobado
- Documentaci√≥n t√©cnica completa y actualizada
- Cumplimiento contractual 100%

PR√ìXIMOS PASOS:
1. Revisi√≥n final por Interventor√≠a
2. Revisi√≥n final por ANI
3. Aprobaci√≥n de cambios menores
4. Preparaci√≥n para construcci√≥n

===========================================
Generado autom√°ticamente el: ${new Date().toLocaleString()}
            `;

            document.getElementById('reportePreview').textContent = reporte;
            document.getElementById('reportePreview').style.display = 'block';

            // Agregar a historial
            reportesData.push({
                fecha: new Date().toISOString().split('T')[0],
                tipo: 'Consolidado',
                destinatario: 'Interventor√≠a + ANI',
                estado: 'GENERADO',
                observaciones: `Reporte ${tipoReporte} generado`,
                timestamp: new Date().toISOString()
            });

            updateStats();
            alert('‚úÖ Reporte consolidado generado exitosamente.');
        }

        // Funci√≥n para exportar reportes
        function exportarReportes() {
            const fechaInicio = document.getElementById('fechaInicio').value || new Date().toISOString().split('T')[0];
            const fechaFin = document.getElementById('fechaFin').value || new Date().toISOString().split('T')[0];
            const tipoReporte = document.getElementById('tipoReporte').value;

            const reporteContent = `
REPORTE CONSOLIDADO - TM01 TRONCAL MAGDALENA
===========================================

Fecha: ${new Date().toLocaleDateString()}
Per√≠odo: ${fechaInicio} a ${fechaFin}
Tipo: ${tipoReporte}
Proyecto: APP Puerto Salgar - Barrancabermeja

RESUMEN EJECUTIVO:
- Total sistemas ITS: ${sistemasITS.length}
- Presupuesto ITS Puro: $7,790,000 USD
- Longitud total: 293 km
- Documentos actualizados: 75+

SISTEMAS ITS VALIDADOS:
${sistemasITS.map(sistema => 
    `- ${sistema.sistema}: ${sistema.especificacion} (${sistema.cantidad} unidades, $${sistema.costo} USD)`
).join('\n')}

ESTADO GENERAL:
- Sistemas aprobados: ${sistemasITS.filter(s => s.estado === 'APROBADO').length}
- Sistemas pendientes: ${sistemasITS.filter(s => s.estado === 'PENDIENTE').length}
- Sistemas rechazados: ${sistemasITS.filter(s => s.estado === 'RECHAZADO').length}

OBSERVACIONES:
- Todos los sistemas ITS cumplen con especificaciones t√©cnicas
- Presupuesto dentro del rango aprobado
- Documentaci√≥n t√©cnica completa y actualizada

PR√ìXIMOS PASOS:
1. Revisi√≥n final por Interventor√≠a
2. Revisi√≥n final por ANI
3. Aprobaci√≥n de cambios menores
4. Preparaci√≥n para construcci√≥n

===========================================
Generado autom√°ticamente el: ${new Date().toLocaleString()}
            `;

            const blob = new Blob([reporteContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Reporte_TM01_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            alert('‚úÖ Reportes exportados exitosamente.');
        }

        // Funci√≥n para imprimir reportes
        function imprimirReportes() {
            const reportePreview = document.getElementById('reportePreview');
            if (reportePreview.style.display === 'none') {
                generarReporteConsolidado();
            }
            window.print();
        }

        // Funci√≥n para renderizar tabla Interventor√≠a
        function renderInterventoriaTable() {
            const tbody = document.getElementById('interventoriaBody');
            let html = '';

            sistemasITS.forEach(sistema => {
                const estadoBadge = getEstadoBadge(sistema.estado);
                const actionButton = getActionButton(sistema.sistema);

                html += `
                    <tr>
                        <td><span class="badge badge-info">${sistema.sistema}</span></td>
                        <td>${sistema.especificacion}</td>
                        <td style="text-align: center; font-weight: bold;">${sistema.cantidad}</td>
                        <td style="text-align: right; font-weight: bold;">$${sistema.costo}</td>
                        <td>${estadoBadge}</td>
                        <td>${sistema.observaciones}</td>
                        <td>${actionButton}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Funci√≥n para renderizar tabla ANI
        function renderANITable() {
            const tbody = document.getElementById('aniBody');
            let html = '';

            sistemasITS.forEach(sistema => {
                const estadoBadge = getEstadoBadge(sistema.estado);
                const actionButton = getActionButton(sistema.sistema);

                html += `
                    <tr>
                        <td><span class="badge badge-info">${sistema.sistema}</span></td>
                        <td>${sistema.especificacion}</td>
                        <td style="text-align: center; font-weight: bold;">${sistema.cantidad}</td>
                        <td style="text-align: right; font-weight: bold;">$${sistema.costo}</td>
                        <td>${estadoBadge}</td>
                        <td>${sistema.observaciones}</td>
                        <td>${actionButton}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Funci√≥n para renderizar tabla Consolidado
        function renderConsolidadoTable() {
            const tbody = document.getElementById('consolidadoBody');
            let html = '';

            sistemasITS.forEach(sistema => {
                const estadoBadge = getEstadoBadge(sistema.estado);
                const actionButton = getActionButton(sistema.sistema);

                html += `
                    <tr>
                        <td><span class="badge badge-info">${sistema.sistema}</span></td>
                        <td>${sistema.especificacion}</td>
                        <td style="text-align: center; font-weight: bold;">${sistema.cantidad}</td>
                        <td style="text-align: right; font-weight: bold;">$${sistema.costo}</td>
                        <td>${estadoBadge}</td>
                        <td>${sistema.observaciones}</td>
                        <td>${actionButton}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Funci√≥n para renderizar tabla Hist√≥rico
        function renderHistoricoTable() {
            const tbody = document.getElementById('historicoBody');
            let html = '';

            reportesData.forEach(reporte => {
                const estadoBadge = getEstadoBadge(reporte.estado);
                const actionButton = getActionButton(reporte.tipo);

                html += `
                    <tr>
                        <td>${reporte.fecha}</td>
                        <td>${reporte.tipo}</td>
                        <td>${reporte.destinatario}</td>
                        <td>${estadoBadge}</td>
                        <td>${reporte.observaciones}</td>
                        <td>${actionButton}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Funci√≥n para obtener badge de estado
        function getEstadoBadge(estado) {
            switch(estado) {
                case 'APROBADO':
                    return '<span class="badge badge-success">APROBADO</span>';
                case 'PENDIENTE':
                    return '<span class="badge badge-warning">PENDIENTE</span>';
                case 'RECHAZADO':
                    return '<span class="badge badge-danger">RECHAZADO</span>';
                case 'GENERADO':
                    return '<span class="badge badge-info">GENERADO</span>';
                default:
                    return '<span class="badge badge-secondary">N/A</span>';
            }
        }

        // Funci√≥n para obtener bot√≥n de acci√≥n
        function getActionButton(sistema) {
            return `<button class="action-btn" onclick="verDetalle('${sistema}')">VER</button>`;
        }

        // Funci√≥n para ver detalle
        function verDetalle(sistema) {
            const sistemaData = sistemasITS.find(s => s.sistema === sistema);
            if (sistemaData) {
                alert(`üìã ${sistema}\n\nEspecificaci√≥n: ${sistemaData.especificacion}\nCantidad: ${sistemaData.cantidad}\nCosto: $${sistemaData.costo} USD\nEstado: ${sistemaData.estado}\nObservaciones: ${sistemaData.observaciones}`);
            }
        }

        // Funci√≥n para actualizar estad√≠sticas
        function updateStats() {
            document.getElementById('totalReportes').textContent = reportesData.length;
            document.getElementById('reportesInterventoria').textContent = reportesData.filter(r => r.tipo === 'Interventor√≠a').length;
            document.getElementById('reportesANI').textContent = reportesData.filter(r => r.tipo === 'ANI').length;
            document.getElementById('reportesConsolidados').textContent = reportesData.filter(r => r.tipo === 'Consolidado').length;
        }

        // Inicializar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer fechas por defecto
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaInicio').value = hoy;
            document.getElementById('fechaFin').value = hoy;
            
            // Renderizar tablas iniciales
            renderInterventoriaTable();
            renderANITable();
            renderConsolidadoTable();
            renderHistoricoTable();
            updateStats();
        });
    </script>
</body>
</html>
