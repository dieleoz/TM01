<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBS Completa - TM01 Troncal Magdalena</title>

    <!-- Librer√≠as -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Estilos -->
    <link rel="stylesheet" href="css/tm01-design-system.css">
    <style>
        /* Estilos espec√≠ficos WBS */
        .wbs-tree {
            font-family: 'Segoe UI Mono', monospace;
            font-size: 0.9em;
        }

        .wbs-item {
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            transition: background var(--transition-fast);
        }

        .wbs-item:hover {
            background-color: var(--bg-hover);
        }

        .wbs-level-1 {
            background-color: var(--tm01-primary);
            color: white;
            font-weight: 700;
            margin-top: var(--space-md);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
        }

        .wbs-level-2 {
            background-color: var(--border-light);
            color: var(--text-main);
            font-weight: 600;
            margin-top: var(--space-sm);
            padding-left: var(--space-lg);
        }

        .wbs-level-3 {
            padding-left: var(--space-2xl);
            color: var(--text-sub);
        }

        .wbs-id {
            min-width: 100px;
            font-weight: 700;
            color: var(--tm01-accent);
        }

        .wbs-desc {
            flex-grow: 1;
        }

        .wbs-meta {
            font-size: 0.85em;
            color: var(--text-muted);
            min-width: 180px;
            text-align: right;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            align-items: center;
        }

        .badge-capex {
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: 0.75em;
            font-weight: 600;
        }
    </style>
</head>

<body>

    <!-- Navbar -->
    <nav class="tm01-navbar">
        <div class="tm01-brand">
            <span style="margin-right: 8px;">üèóÔ∏è</span>
            TM01 Troncal Magdalena
            <span class="tm01-status-badge" style="margin-left: 10px;">Audit 6.0 Verified</span>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="WBS_Menu_Principal.html" class="tm01-btn tm01-btn-link">‚Üê Volver al Men√∫</a>
            <button class="tm01-btn" onclick="exportarExcel()">üìä Exportar Excel</button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="tm01-container" style="padding-top: var(--space-xl);">

        <!-- Header -->
        <div style="margin-bottom: var(--space-lg); display: flex; justify-content: space-between; align-items: end;">
            <div>
                <h1 style="color: var(--tm01-primary); margin-bottom: 5px;">Estructura de Desglose de Trabajo (WBS)</h1>
                <p style="color: var(--text-sub);">Fuente de Verdad: Ingenier√≠a de Detalle (T05) + Dict√°menes Jur√≠dicos
                </p>
            </div>
            <div>
                <button class="tm01-btn tm01-btn-primary" onclick="window.print()">üñ®Ô∏è Imprimir</button>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="tm01-grid-3" style="margin-bottom: var(--space-xl);">
            <div class="tm01-stat">
                <div class="tm01-stat-value" id="totalItems">...</div>
                <div class="tm01-stat-label">Total Items WBS</div>
            </div>
            <div class="tm01-stat">
                <div class="tm01-stat-value" id="costoTotal" style="color: var(--success);">...</div>
                <div class="tm01-stat-label">CAPEX Total ITS (USD)</div>
            </div>
            <div class="tm01-stat">
                <div class="tm01-stat-value" id="totalSistemas" style="color: var(--info);">...</div>
                <div class="tm01-stat-label">Sistemas Activos</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="tm01-card" style="margin-bottom: var(--space-lg);">
            <h3>üîç Filtros de B√∫squeda</h3>
            <div style="display: flex; gap: var(--space-md); flex-wrap: wrap;">
                <select id="sistemaFilter" class="tm01-btn"
                    style="flex: 1; background: white; border-color: var(--border);">
                    <option value="">Todos los Sistemas</option>
                </select>
                <select id="nivelFilter" class="tm01-btn"
                    style="flex: 1; background: white; border-color: var(--border);">
                    <option value="">Todos los Niveles</option>
                    <option value="1">Cap√≠tulos (Nivel 1)</option>
                    <option value="2">Subcap√≠tulos (Nivel 2)</option>
                    <option value="3">Items (Nivel 3)</option>
                </select>
                <input type="text" id="searchInput" class="tm01-btn" placeholder="Buscar item..."
                    style="flex: 2; background: white; border-color: var(--border); cursor: text;">
                <button class="tm01-btn tm01-btn-primary" onclick="filtrarWBS()">Filtrar</button>
                <button class="tm01-btn" onclick="limpiarFiltros()">Limpiar</button>
            </div>
        </div>

        <!-- Subtotals Panel -->
        <div id="subtotalesSection" class="tm01-section" style="display: none;">
            <div class="tm01-section-header">üí∞ Subtotales por Sistema</div>
            <div id="subtotalesGrid" class="tm01-section-content tm01-grid-4"></div>
        </div>

        <div style="text-align: right; margin-bottom: var(--space-md);">
            <button class="tm01-btn tm01-btn-link" onclick="toggleSubtotales()">üëÅÔ∏è Ver/Ocultar Subtotales</button>
        </div>

        <!-- WBS Tree -->
        <div class="tm01-card" style="padding: 0; overflow: hidden;">
            <div id="wbsTree" class="wbs-tree" style="max-height: 800px; overflow-y: auto;">
                <div style="padding: 40px; text-align: center; color: var(--text-muted);">
                    <div style="margin-bottom: 10px;">‚è≥</div> Cargando Datos Maestros...
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="margin: var(--space-2xl) 0; color: var(--text-muted); font-size: 0.8em; text-align: center;">
            <p><strong>TM01 Troncal Magdalena</strong> - Sistema de Gesti√≥n Contractual</p>
            <p>Metodolog√≠a: Punto 42 v3.0 (Layer 5 Services) | Validaci√≥n: Agent 3</p>
        </div>

    </div>

    <!-- Scripts -->
    <script src="data/tm01_master_data.js?v=20260130"></script>
    <script src="datos_wbs_TM01_items.js?v=20260130"></script>

    <!-- Logic -->
    <script src="js/wbs-dt.js"></script>
    <script src="js/wbs-export.js"></script>
    <script src="js/wbs-main.js"></script>

</body>

</html>