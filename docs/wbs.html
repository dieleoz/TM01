<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBS Completa - TM01 Troncal Magdalena</title>

    <!-- Librer√≠as -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Estilos -->
    <link rel="stylesheet" href="css/tm01-design-system.css">
    <style>
        /* Estilos espec√≠ficos WBS que complementan el Design System */
        .wbs-container {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            padding: 24px;
            margin-top: 24px;
        }

        .wbs-tree {
            font-family: var(--font-mono);
            font-size: 0.9em;
        }

        .wbs-item {
            padding: 8px 12px;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }

        .wbs-item:hover {
            background-color: var(--gray-50);
        }

        .wbs-level-1 {
            background-color: var(--bg-primary);
            color: white;
            font-weight: bold;
            margin-top: 10px;
            border-radius: 4px;
        }

        .wbs-level-2 {
            background-color: var(--gray-200);
            color: var(--text-primary);
            font-weight: 600;
            margin-top: 5px;
        }

        .wbs-level-3 {
            padding-left: 30px;
        }

        .wbs-id {
            min-width: 80px;
            font-weight: bold;
            color: var(--primary);
        }

        .wbs-desc {
            flex-grow: 1;
        }

        .wbs-meta {
            font-size: 0.85em;
            color: var(--text-secondary);
            min-width: 150px;
            text-align: right;
        }

        .badge-capex {
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }
    </style>
</head>

<body class="bg-gray-50">

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="brand-icon">üèóÔ∏è</span>
                <span class="brand-text">TM01 Troncal Magdalena</span>
            </div>
            <div class="nav-menu">
                <a href="WBS_Menu_Principal.html" class="nav-link">‚Üê Volver al Men√∫</a>
                <span class="badge badge-success">Audit 6.0 Certified</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container main-content">

        <!-- Header -->
        <header class="page-header">
            <div class="header-content">
                <h1>Estructura de Desglose de Trabajo (WBS)</h1>
                <p>Fuente de Verdad: Ingenier√≠a de Detalle (T05) + Dict√°menes Jur√≠dicos</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportarCSV()">üì• CSV</button>
                <button class="btn btn-primary" onclick="exportarExcel()">üìä Excel</button>
            </div>
        </header>

        <!-- KPI Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìë</div>
                <div class="stat-info">
                    <h3>Total Items</h3>
                    <p class="stat-value" id="totalItems">Cargando...</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-info">
                    <h3>CAPEX Total ITS</h3>
                    <p class="stat-value" id="costoTotal">Cargando...</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üîß</div>
                <div class="stat-info">
                    <h3>Sistemas</h3>
                    <p class="stat-value" id="totalSistemas">Cargando...</p>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="card p-4 mb-4">
            <h3 class="card-title mb-3">üîç Filtros de B√∫squeda</h3>
            <div class="filter-group" style="display: flex; gap: 15px; flex-wrap: wrap;">
                <select id="sistemaFilter" class="form-control" style="flex: 1;">
                    <option value="">Todos los Sistemas</option>
                </select>
                <select id="nivelFilter" class="form-control" style="flex: 1;">
                    <option value="">Todos los Niveles</option>
                    <option value="1">Cap√≠tulos (Nivel 1)</option>
                    <option value="2">Subcap√≠tulos (Nivel 2)</option>
                    <option value="3">Items (Nivel 3)</option>
                </select>
                <input type="text" id="searchInput" class="form-control" placeholder="Buscar item..." style="flex: 2;">
                <button class="btn btn-primary" onclick="filtrarWBS()">Filtrar</button>
                <button class="btn btn-outline" onclick="limpiarFiltros()">Limpiar</button>
            </div>
        </div>

        <!-- Subtotals Panel -->
        <div id="subtotalesSection" class="card p-4 mb-4" style="display: none;">
            <h3 class="card-title">üí∞ Subtotales por Sistema</h3>
            <div id="subtotalesGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-3"></div>
        </div>

        <div class="mb-3 text-right">
            <button class="btn btn-sm btn-secondary" onclick="toggleSubtotales()">üëÅÔ∏è Ver/Ocultar Subtotales</button>
        </div>

        <!-- WBS Tree -->
        <div class="wbs-container">
            <div id="wbsTree" class="wbs-tree">
                <div class="text-center p-5 text-gray-500">
                    <div class="spinner"></div> Cargando Datos Maestros...
                </div>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p><strong>TM01 Troncal Magdalena</strong> - Sistema de Gesti√≥n Contractual</p>
            <p>Metodolog√≠a: Punto 42 v3.0 (Layer 5 Services)</p>
            <p>Validaci√≥n: Agent 3 (Audit 6.0)</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="data/tm01_master_data.js?v=20260130"></script>
    <script src="datos_wbs_TM01_items.js?v=20260130"></script>

    <!-- Logic -->
    <script src="js/wbs-dt.js"></script>
    <script src="js/wbs-export.js"></script>
    <script src="js/wbs-main.js"></script>

</body>

</html>